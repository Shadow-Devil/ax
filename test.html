<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>AX Test Site</title>
</head>

<body>
	<script type="module">
		import * as ax from './pkg/ax.js';
		let module = await ax.default();
		console.log("Initialized module!")
		window.ax = module;


		async function execute() {
			try {
				function sleep(time) {
					return new Promise((resolve) => setTimeout(resolve, time));
				}
				// let arg = async function(arg0, arg1, arg2) {
				// 	console.log("arg0:", arg0);
				// 	await sleep(1000);
				// 	console.log("arg1:", arg1);
				// 	await sleep(1000);
				// 	console.log("arg2:", arg2);
				// 	await sleep(1000);
				// 	console.log("Called async function:", this);
				// 	await sleep(1000);
				// 	return "ok";
				// }
				let arg = function (arg0, arg1, arg2) {
					console.log("arg0:", arg0);
					console.log("arg1:", arg1);
					console.log("arg2:", arg2);
					console.log("Called normal function:", this);
					return "ok";
				}

				let result = await ax.execute_sync_or_async(arg);
				console.log("result:", result);

			} catch (e) {
				console.error("Caught:", e);
			}
		}

		// mov rax, 5; sub rax, 5
		let code = new Uint8Array([0x48, 0xc7, 0xc0, 0x5, 0x0, 0x0, 0x0, 0x48, 0x83, 0xe8, 0x5]);

		let ex = new ax.Axecutor(code, 0x1n, 0x1n);

		console.log(ex.toString());

		while (await ex.step()) {
			console.log(ex);
			console.log(ex.toString());
		}

		console.log("Final state:\n" + ex.toString());
	</script>
</body>

</html>
